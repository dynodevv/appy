# Copilot Instructions for Appy

This is an Android repository with Kotlin (app module) and Java (template module). It converts website URLs into standalone Android APKs using a unique binary template modification strategy. Please follow these guidelines when contributing:

## Code Standards

### Required Before Each Commit
- Run `./gradlew assembleDebug --no-daemon` before committing to ensure code compiles
- Use `chmod +x gradlew` if gradlew is not executable
- For CI consistency, build commands should always use `--no-daemon` flag

### Development Flow
- Build: `./gradlew assembleDebug --no-daemon`
- Release: `./gradlew assembleRelease --no-daemon` (requires signing config)
- Clean: `./gradlew clean` (use if encountering "duplicate class" errors)
- Template only: `./gradlew :template:assembleRelease`

### Testing
There are currently no automated tests. Manual testing required:
1. Install debug APK on device/emulator (API 26+)
2. Launch Appy, enter URL (e.g., `https://example.com`)
3. Generate APK and verify installation and WebView functionality

## Repository Structure
- `app/`: Main Appy application (Kotlin, Jetpack Compose)
  - `src/main/java/com/appy/MainActivity.kt`: Entry point
  - `src/main/java/com/appy/ui/screens/HomeScreen.kt`: Main UI
  - `src/main/java/com/appy/processor/ApkProcessor.kt`: Core APK generation logic
  - `src/main/assets/base-web-template.apk`: Pre-compiled template (auto-copied)
  - `src/main/assets/debug.p12`: Debug keystore (publicly committed, for development only - never use for production)
- `template/`: Pure Java WebView template with **ZERO external dependencies**
  - `src/main/java/com/webtemplate/MainActivity.java`: WebView activity
  - `src/main/assets/config.json`: URL configuration placeholder
  - Built automatically before main app via `copyTemplateApk` task
- `.github/workflows/ci.yml`: CI builds on push/PR to main
- `.github/workflows/appy_release.yml`: Release builds on version tags

## Key Guidelines
1. **Template module constraints**: MUST remain pure Java with zero external dependencies
2. **Build sequence**: Template is built first and copied to `app/src/main/assets/` automatically
3. **Binary template modification**: APKs are generated by modifying the pre-compiled template, not building from scratch
4. **Package ID**: Template uses 41-char placeholder `com.appy.generated.webapp.placeholder.app` replaced via binary manifest modification
5. **Kotlin conventions**: Use Coroutines and Flow for async operations, sealed classes for results
6. **Jetpack Compose**: Use Material 3 Expressive theme for UI components
7. **Configuration injection**: Config is injected via `assets/config.json` with manual JSON parsing (no Gson/Moshi)
8. **Manual testing only**: Validate changes by building, installing, and testing end-to-end APK generation flow
9. **Known issue**: Custom icon injection is implemented but non-functional (icons don't appear in generated APKs)
